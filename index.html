let figuras = [];
let textura_papel;
let r;
let numero;
let caminantes = [];
let controlPoints = [];
let ImagenActual = 3;

function preload() {
  for (let i = 0; i < 6; i++) {
    figuras.push(loadImage("imagenes/figura" + i + ".png"));
  }
  textura_papel = loadImage("imagenes/textura_fondo.png");
}

function setup() {
  createCanvas(594, 869);

  let numCaminantes = 3;
  let radius = 150;
  let centerX = width / 2;
  let centerY = height / 2;

  for (let i = 0; i < numCaminantes; i++) {
    let angle = (TWO_PI / numCaminantes) * i;
    let x = centerX + cos(angle) * radius;
    let y = centerY + sin(angle) * radius;
    caminantes.push(new Caminante(x, y));
  }

  numero = random(2, 5);
  r = 25;

  // Inicializar puntos de control
  initializeControlPoints();
}

function draw() {
  background(textura_papel);
  push();
  imageMode(CENTER);
  image(figuras[ImagenActual], width / 2, height / 2);
  pop();

  push();
  strokeWeight(30);
  // stroke(129, 166, 202);
  strokeJoin(ROUND);
  strokeCap(ROUND);

  // Dibujar curvas bezier entre los caminantes
  for (let i = 0; i < caminantes.length; i++) {
    let c1 = caminantes[i];
    let c2 = caminantes[(i + 1) % caminantes.length];
    drawBezierCurve(c1, c2, i);
  }

  pop();

  console.log(mouseX, mouseY);

  for (let caminante of caminantes) {
    caminante.dibujar();
    caminante.mover(caminantes);
  }

  // Actualizar puntos de control lentamente
  updateControlPoints();
}

function initializeControlPoints() {
  for (let i = 0; i < caminantes.length; i++) {
    let c1 = caminantes[i];
    let c2 = caminantes[(i + 1) % caminantes.length];
    controlPoints.push({
      x1: (2 * c1.x + c2.x) / 3 + random(-50, 50),
      y1: (2 * c1.y + c2.y) / 3 + random(-50, 50),
      x2: (c1.x + 2 * c2.x) / 3 + random(-50, 50),
      y2: (c1.y + 2 * c2.y) / 3 + random(-50, 50),
    });
  }
}

function updateControlPoints() {
  for (let i = 0; i < caminantes.length; i++) {
    let c1 = caminantes[i];
    let c2 = caminantes[(i + 1) % caminantes.length];
    let cp = controlPoints[i];

    cp.x1 = lerp(cp.x1, (2 * c1.x + c2.x) / 3 + random(-50, 50), 0.01);
    cp.y1 = lerp(cp.y1, (2 * c1.y + c2.y) / 3 + random(-50, 50), 0.01);
    cp.x2 = lerp(cp.x2, (c1.x + 2 * c2.x) / 3 + random(-50, 50), 0.01);
    cp.y2 = lerp(cp.y2, (c1.y + 2 * c2.y) / 3 + random(-50, 50), 0.01);
  }
}

function drawBezierCurve(c1, c2, index) {
  let cp = controlPoints[index];
  push();
  noFill();
  bezier(c1.x, c1.y, cp.x1 + 30, cp.y1 + 20, cp.x2 + 1, cp.y2, c2.x, c2.y);
  pop();
}

function mouseClicked() {
  ImagenActual++;

  if (ImagenActual >= figuras.length) {
    ImagenActual = 0;
  }
}
